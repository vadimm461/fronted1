<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Счет</title>

<style>

body{
font-family: Arial, sans-serif;
background:#f2f4f8;
padding:20px;
margin:0;
}

/* кнопка назад */
.back-button{
position:fixed;
top:15px;
left:15px;
z-index:9999;
background:#000;
color:#fff;
border:none;
padding:8px 14px;
border-radius:6px;
cursor:pointer;
font-size:13px;
}

/* контейнер */
.container{
max-width:900px;
width:100%;
margin:auto;
background:white;
padding:40px;
box-shadow:0 4px 20px rgba(0,0,0,.1);
box-sizing:border-box;
}

.header{
text-align:center;
margin-bottom:25px;
}

table{
width:100%;
border-collapse:collapse;
margin-top:10px;
}

th,td{
border:1px solid #ccc;
padding:8px;
font-size:14px;
}

th{
background:#1976d2;
color:white;
}

input{
width:100%;
border:none;
outline:none;
font-size:14px;
background:transparent;
}

.total{
text-align:right;
font-weight:bold;
font-size:16px;
}

.buttons{
margin-top:20px;
}

.buttons button{
width:100%;
padding:12px;
margin-bottom:10px;
border:none;
border-radius:6px;
background:#2e7d32;
color:white;
font-size:16px;
cursor:pointer;
}

/* кнопка удалить */
.delete-btn{
background:#d32f2f;
color:white;
border:none;
padding:6px 10px;
border-radius:4px;
cursor:pointer;
}

/* мобильная адаптация */
@media (max-width:768px){

body{
padding:10px;
}

.container{
padding:15px;
}

th,td{
font-size:12px;
padding:6px;
}

}

/* печать */
@media print{

.buttons,
.back-button,
.delete-btn{
display:none;
}

.container{
box-shadow:none;
padding:0;
}

}

</style>
</head>
<body>

<button class="back-button" onclick="history.back()">← Назад</button>

<div class="container">

<div class="header">
<h2>СЧЕТ НА ОПЛАТУ № <span id="invoice-number"></span></h2>
<div>Дата: <span id="date"></span></div>
</div>

<div>
<b>Плательщик:</b>
<input placeholder="Введите организацию">
</div>

<br>

<table>
<tr><td>ИП</td><td>Дворян Вадим Витальевич</td></tr>
<tr><td>УСН</td><td>1440001838</td></tr>
<tr><td>Расчетный счет</td><td>2214050000024165</td></tr>
<tr><td>Банк</td><td>ЗАО "Агропромбанк"</td></tr>
</table>

<br>

<table>

<thead>
<tr>
<th>Код</th>
<th>Наименование</th>
<th>Кол-во</th>
<th>Цена</th>
<th></th>
</tr>
</thead>

<tbody id="tbody"></tbody>

<tfoot>
<tr>
<td colspan="4" class="total">Итого:</td>
<td id="total">0</td>
</tr>
</tfoot>

</table>

<div class="buttons">
<button onclick="addRow()">Добавить строку</button>
<button onclick="printPDF()">Скачать PDF</button>
</div>

</div>

<script>

/* дата */
document.getElementById("date").innerText =
new Date().toLocaleDateString("ru-RU");

/* номер счета */
document.getElementById("invoice-number").innerText =
Math.floor(Math.random()*21);

/* добавить строку */
function addRow(){

let row = document.createElement("tr");

row.innerHTML = `
<td><input></td>
<td><input></td>
<td><input type="number" class="qty" value="0"></td>
<td><input type="number" class="price" value="0"></td>
<td><button class="delete-btn">✕</button></td>
`;

document.getElementById("tbody").appendChild(row);

/* удаление строки */
row.querySelector(".delete-btn").onclick = ()=>{
row.remove();
calc();
};

/* авторасчет + автодобавление */
row.querySelectorAll("input").forEach(input=>{
input.addEventListener("input", ()=>{
calc();
autoAddRow();
});
});

}

/* автодобавление строки если заполняется последняя */
function autoAddRow(){

let rows = document.querySelectorAll("#tbody tr");
let last = rows[rows.length-1];

let filled = false;

last.querySelectorAll("input").forEach(i=>{
if(i.value && i.value != 0) filled = true;
});

if(filled) addRow();

}

/* расчет */
function calc(){

let total=0;

document.querySelectorAll("#tbody tr").forEach(row=>{
let q = Number(row.querySelector(".qty")?.value || 0);
let p = Number(row.querySelector(".price")?.value || 0);
total += q*p;
});

document.getElementById("total").innerText =
total.toLocaleString('ru-RU');

}

/* печать */
function printPDF(){
calc();
window.print();
}

/* стартовая одна строка */
addRow();

</script>

</body>
</html>
