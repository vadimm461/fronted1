<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Генератор счета</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>

body{
font-family: Arial;
background:#f2f4f8;
padding:20px;
}

.container{
width:900px;
margin:auto;
}

#print-area{
background:white;
padding:40px;
box-shadow:0 4px 20px rgba(0,0,0,.1);
}

.header{
text-align:center;
margin-bottom:25px;
}

table{
width:100%;
border-collapse:collapse;
margin-top:10px;
}

th,td{
border:1px solid #ccc;
padding:8px;
font-size:14px;
}

th{
background:#1976d2;
color:white;
}

td:nth-child(1){width:60px;}
td:nth-child(3){width:70px;}
td:nth-child(4){width:90px;}

input{
width:100%;
border:none;
outline:none;
font-size:14px;
}

.total{
text-align:right;
font-weight:bold;
}

button{
width:100%;
padding:12px;
margin-top:10px;
border:none;
background:#2e7d32;
color:white;
font-size:16px;
cursor:pointer;
}

</style>
</head>
<body>

<div class="container">

<div id="print-area">

<div class="header">
<h2>СЧЕТ НА ОПЛАТУ № <span id="invoice-number"></span></h2>
<div>Дата: <span id="date"></span></div>
</div>

<div>
<b>Плательщик:</b>
<input id="payer">
</div>

<br>

<table>
<tr><td>ИП</td><td>Дворян Вадим Витальевич</td></tr>
<tr><td>УСН</td><td>1440001838</td></tr>
<tr><td>Расчетный счет</td><td>2214050000024165</td></tr>
<tr><td>Банк</td><td>ЗАО "Агропромбанк"</td></tr>
</table>

<br>

<table id="items">

<thead>
<tr>
<th>Код</th>
<th>Наименование</th>
<th>Кол-во</th>
<th>Цена</th>
</tr>
</thead>

<tbody id="tbody"></tbody>

<tfoot>
<tr>
<td colspan="3" class="total">Итого</td>
<td id="total">0</td>
</tr>
</tfoot>

</table>

</div>

<button onclick="addRow()">Добавить строку</button>
<button onclick="calc()">Рассчитать</button>
<button onclick="generatePDF()">Скачать PDF</button>

</div>

<script>

/* дата */
document.getElementById("date").innerText =
new Date().toLocaleDateString("ru-RU");

/* номер */
document.getElementById("invoice-number").innerText =
Math.floor(Math.random()*21);

/* строки */
function addRow(){
document.getElementById("tbody").insertAdjacentHTML("beforeend",`
<tr>
<td><input></td>
<td><input></td>
<td><input type="number" class="qty" value="0"></td>
<td><input type="number" class="price" value="0"></td>
</tr>
`);
}

for(let i=0;i<8;i++) addRow();

/* расчет */
function calc(){
let total=0;

document.querySelectorAll("#tbody tr").forEach(row=>{
let q = Number(row.querySelector(".qty").value);
let p = Number(row.querySelector(".price").value);
total += q*p;
});

document.getElementById("total").innerText =
total.toLocaleString('ru-RU');
}

/* генерация */
function generatePDF(){

calc();

/* новый номер */
const invoiceNumber=Math.floor(Math.random()*21);
document.getElementById("invoice-number").innerText=invoiceNumber;

/* КЛОН */
const clone = document.getElementById("print-area").cloneNode(true);

/* перенос значений */
const inputsOriginal = document.querySelectorAll("#print-area input");
const inputsClone = clone.querySelectorAll("input");

inputsOriginal.forEach((input,i)=>{
const span=document.createElement("span");
span.textContent=input.value;
inputsClone[i].replaceWith(span);
});

/* вставляем временно */
clone.style.position="fixed";
clone.style.left="-10000px";
document.body.appendChild(clone);

html2pdf().set({
margin:10,
filename:'Счет_'+invoiceNumber+'.pdf',
html2canvas:{scale:2},
jsPDF:{unit:'mm',format:'a4'}
}).from(clone).save().then(()=>{
clone.remove();
});

}

</script>

</body>
</html>
